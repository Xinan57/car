<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoCare Pro - KFZ Verwaltung</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            --dark: #1f2937;
            --light: #f3f4f6;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--white);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        nav {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            background: var(--light);
            color: var(--dark);
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .nav-btn:hover, .nav-btn.active {
            background: var(--primary);
            color: var(--white);
            transform: translateY(-2px);
        }

        .nav-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--white);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--white);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .garage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
        }

        .car-card {
            background: linear-gradient(145deg, #ffffff, #f3f4f6);
            border-radius: 20px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
        }

        .car-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .car-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .car-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .car-name {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .car-details {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .car-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat {
            background: var(--light);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .workshop-finder {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .workshop-card {
            background: var(--white);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .workshop-card:hover {
            transform: scale(1.02);
            border-color: var(--primary);
        }

        .workshop-logo {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .workshop-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .service-list {
            list-style: none;
            text-align: left;
            margin-top: 15px;
        }

        .service-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .service-list li:before {
            content: "‚úì";
            color: var(--success);
            font-weight: bold;
        }

        .checkbook-entry {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
        }

        .checkbook-entry:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .entry-date {
            font-weight: 700;
            color: var(--primary);
        }

        .entry-type {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
        }

        .costs-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .cost-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .cost-amount {
            font-size: 28px;
            font-weight: 800;
            margin: 10px 0;
        }

        .chart-container {
            height: 300px;
            background: var(--light);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .reminder-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--danger);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .fuel-tracker {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .fuel-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .garage-grid, .workshop-finder, .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }
            
            nav {
                width: 100%;
                justify-content: center;
            }
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 10;
        }

        .car-card:hover .delete-btn {
            opacity: 1;
        }

        .document-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .document-card {
            background: var(--light);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .document-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .document-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .document-upload {
            border: 3px dashed #ccc;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .document-upload:hover {
            border-color: var(--primary);
            background: #f0f7ff;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--dark);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            display: none;
            animation: slideIn 0.3s;
            z-index: 2000;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        .toast.show {
            display: block;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .trip-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .trip-item {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .community-post {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
        }

        .search-box:before {
            content: "üîç";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
        }

        .filter-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .tag {
            padding: 6px 12px;
            background: var(--light);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag:hover, .tag.active {
            background: var(--primary);
            color: white;
        }

        .price-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .price-card {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .price {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }

        .rating {
            color: var(--secondary);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
        }

        .notification-panel {
            position: fixed;
            top: 100px;
            right: 20px;
            width: 350px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow-lg);
            padding: 20px;
            display: none;
            z-index: 999;
        }

        .notification-panel.show {
            display: block;
        }

        .notification-item {
            padding: 15px;
            border-left: 4px solid var(--primary);
            background: var(--light);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
        }

        .notification-item.warning {
            border-left-color: var(--danger);
        }

        .notification-item.success {
            border-left-color: var(--success);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .quick-action {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
        }

        .quick-action:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .quick-action-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <div class="logo">
                <div class="logo-icon">üöó</div>
                <span>AutoCare Pro</span>
            </div>
            <nav>
                <button class="nav-btn active" onclick="showSection('garage')">
                    <span>üè†</span> Garage
                </button>
                <button class="nav-btn" onclick="showSection('workshop')">
                    <span>üîß</span> Werkstatt
                </button>
                <button class="nav-btn" onclick="showSection('checkbook')">
                    <span>üìã</span> Checkheft
                </button>
                <button class="nav-btn" onclick="showSection('costs')">
                    <span>üí∞</span> Kosten
                </button>
                <button class="nav-btn" onclick="showSection('documents')">
                    <span>üìÑ</span> Dokumente
                </button>
                <button class="nav-btn" onclick="showSection('trips')">
                    <span>üõ£Ô∏è</span> Fahrten
                </button>
                <button class="nav-btn" onclick="showSection('community')">
                    <span>üë•</span> Community
                </button>
                <button class="nav-btn" onclick="toggleNotifications()" style="position: relative;">
                    <span>üîî</span>
                    <span class="nav-badge" id="notifCount" style="display: none;">!</span>
                </button>
            </nav>
        </header>

        <!-- Quick Actions -->
        <div class="quick-actions" id="quickActions">
            <div class="quick-action" onclick="openModal('addCarModal')">
                <div class="quick-action-icon">‚ûï</div>
                <div>Auto hinzuf√ºgen</div>
            </div>
            <div class="quick-action" onclick="showSection('workshop')">
                <div class="quick-action-icon">üîç</div>
                <div>Werkstatt finden</div>
            </div>
            <div class="quick-action" onclick="openFuelModal()">
                <div class="quick-action-icon">‚õΩ</div>
                <div>Tanken eintragen</div>
            </div>
            <div class="quick-action" onclick="openTripModal()">
                <div class="quick-action-icon">üìù</div>
                <div>Fahrt eintragen</div>
            </div>
        </div>

        <!-- Garage Section -->
        <section id="garage" class="section active">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Meine Garage</h2>
                    <button class="btn btn-primary" onclick="openModal('addCarModal')">
                        <span>+</span> Auto hinzuf√ºgen
                    </button>
                </div>
                <div id="garageGrid" class="garage-grid"></div>
            </div>
        </section>

        <!-- Workshop Section -->
        <section id="workshop" class="section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Werkstatt-Finder & Vergleich</h2>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab(this, 'workshop-map')">Karte</div>
                    <div class="tab" onclick="switchTab(this, 'workshop-compare')">Preisvergleich</div>
                    <div class="tab" onclick="switchTab(this, 'workshop-reviews')">Bewertungen</div>
                </div>

                <div id="workshop-map" class="tab-content active">
                    <div class="workshop-finder">
                        <div class="workshop-card" onclick="findWorkshops('atu')">
                            <div class="workshop-logo">üîµ</div>
                            <div class="workshop-name">ATU</div>
                            <p>Auto-Teile-Unger</p>
                            <ul class="service-list">
                                <li>Inspektion & Wartung</li>
                                <li>Reifenservice</li>
                                <li>Klimaservice</li>
                                <li>Diagnose & Reparatur</li>
                            </ul>
                            <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê (4.2)</div>
                        </div>
                        <div class="workshop-card" onclick="findWorkshops('pitstop')">
                            <div class="workshop-logo">üî¥</div>
                            <div class="workshop-name">PIT STOP</div>
                            <p>Reifen & Autoservice</p>
                            <ul class="service-list">
                                <li>Reifenwechsel</li>
                                <li>√ñlwechsel</li>
                                <li>Bremsenservice</li>
                                <li>Achsmessung</li>
                            </ul>
                            <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.5)</div>
                        </div>
                    </div>
                    <div id="workshopResults" style="margin-top: 30px;"></div>
                </div>

                <div id="workshop-compare" class="tab-content">
                    <h3>√ñlwechsel Preisvergleich</h3>
                    <div class="price-comparison">
                        <div class="price-card">
                            <h4>ATU</h4>
                            <div class="price">89 ‚Ç¨</div>
                            <p>Inkl. 5L √ñl & Filter</p>
                            <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê</div>
                            <button class="btn btn-primary" style="margin-top: 10px;">Termin buchen</button>
                        </div>
                        <div class="price-card">
                            <h4>PIT STOP</h4>
                            <div class="price">79 ‚Ç¨</div>
                            <p>Inkl. 5L √ñl & Filter</p>
                            <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                            <button class="btn btn-primary" style="margin-top: 10px;">Termin buchen</button>
                        </div>
                    </div>
                </div>

                <div id="workshop-reviews" class="tab-content">
                    <div class="community-post">
                        <div class="post-header">
                            <div class="avatar">MK</div>
                            <div>
                                <div style="font-weight: bold;">Max K.</div>
                                <div style="font-size: 12px; color: #666;">Vor 2 Tagen ‚Ä¢ ATU M√ºnchen</div>
                            </div>
                        </div>
                        <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                        <p>Sehr schneller Service, freundliches Personal. √ñlwechsel in 30 Minuten erledigt!</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Checkbook Section -->
        <section id="checkbook" class="section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Digitales Checkheft</h2>
                    <select id="carSelectCheckbook" class="btn btn-secondary" onchange="loadCheckbook()">
                        <option value="">Fahrzeug w√§hlen...</option>
                    </select>
                </div>
                <div id="checkbookContent">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìñ</div>
                        <h3>W√§hle ein Fahrzeug aus</h3>
                        <p>Um das Checkheft zu sehen, w√§hle bitte ein Auto aus deiner Garage.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Costs Section -->
        <section id="costs" class="section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Kosten√ºbersicht & Analysen</h2>
                    <select id="carSelectCosts" class="btn btn-secondary" onchange="loadCosts()">
                        <option value="">Alle Fahrzeuge</option>
                    </select>
                </div>
                
                <div class="costs-summary" id="costsSummary">
                    <div class="cost-card">
                        <div>Gesamtkosten</div>
                        <div class="cost-amount" id="totalCosts">0 ‚Ç¨</div>
                        <div>Seit Kauf</div>
                    </div>
                    <div class="cost-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <div>Dieses Jahr</div>
                        <div class="cost-amount" id="yearCosts">0 ‚Ç¨</div>
                        <div>2024</div>
                    </div>
                    <div class="cost-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                        <div>√ò pro km</div>
                        <div class="cost-amount" id="costPerKm">0 ‚Ç¨</div>
                        <div>Laufende Kosten</div>
                    </div>
                    <div class="cost-card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                        <div>√ò pro Monat</div>
                        <div class="cost-amount" id="costPerMonth">0 ‚Ç¨</div>
                        <div>Fixkosten</div>
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab(this, 'cost-chart')">Kostenverteilung</div>
                    <div class="tab" onclick="switchTab(this, 'cost-history')">Verlauf</div>
                    <div class="tab" onclick="switchTab(this, 'cost-parts')">Teilekatalog</div>
                </div>

                <div id="cost-chart" class="tab-content active">
                    <div class="chart-container" id="costChart">
                        <canvas id="costsCanvas" width="600" height="300"></canvas>
                    </div>
                </div>

                <div id="cost-history" class="tab-content">
                    <div id="costHistoryList"></div>
                </div>

                <div id="cost-parts" class="tab-content">
                    <div class="filter-tags">
                        <span class="tag active">Alle</span>
                        <span class="tag">Verschlei√üteile</span>
                        <span class="tag">Filter</span>
                        <span class="tag">Bremsen</span>
                    </div>
                    <div id="partsList"></div>
                </div>

                <div class="fuel-tracker">
                    <h3>‚õΩ Spritverbrauch-Tracker</h3>
                    <div class="fuel-stats">
                        <div>
                            <div style="font-size: 24px; font-weight: bold;" id="avgConsumption">-- l/100km</div>
                            <div>Durchschnitt</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold;" id="lastConsumption">-- l/100km</div>
                            <div>Letzte Tankf√ºllung</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold;" id="totalFuel">-- L</div>
                            <div>Gesamt getankt</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold;" id="fuelCosts">-- ‚Ç¨</div>
                            <div>Spritkosten</div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="openFuelModal()" style="margin-top: 15px;">
                        + Tankf√ºllung eintragen
                    </button>
                </div>
            </div>
        </section>

        <!-- Documents Section -->
        <section id="documents" class="section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Dokumentenverwaltung</h2>
                    <button class="btn btn-primary" onclick="openModal('uploadDocModal')">
                        <span>üì§</span> Dokument hochladen
                    </button>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab(this, 'docs-all')">Alle Dokumente</div>
                    <div class="tab" onclick="switchTab(this, 'docs-expiring')">L√§uft ab bald</div>
                </div>

                <div id="docs-all" class="tab-content active">
                    <div class="document-grid" id="documentGrid">
                        <!-- Documents will be loaded here -->
                    </div>
                    <div class="document-upload" onclick="openModal('uploadDocModal')">
                        <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
                        <h3>Dokument hochladen</h3>
                        <p>Ziehe Dateien hierher oder klicke zum Ausw√§hlen</p>
                        <small>Unterst√ºtzt: PDF, JPG, PNG (max. 10MB)</small>
                    </div>
                </div>

                <div id="docs-expiring" class="tab-content">
                    <div id="expiringDocs"></div>
                </div>
            </div>
        </section>

        <!-- Trips Section -->
        <section id="trips" class="section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Fahrtenbuch</h2>
                    <div>
                        <button class="btn btn-secondary" onclick="exportTrips()">üìä Exportieren</button>
                        <button class="btn btn-primary" onclick="openTripModal()">+ Fahrt eintragen</button>
                    </div>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <select id="tripCarSelect" onchange="loadTrips()">
                            <option value="">Alle Fahrzeuge</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <select id="tripTypeFilter" onchange="loadTrips()">
                            <option value="">Alle Fahrten</option>
                            <option value="business">Gesch√§ftlich</option>
                            <option value="private">Privat</option>
                        </select>
                    </div>
                </div>

                <div class="costs-summary" style="margin-bottom: 20px;">
                    <div class="cost-card" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">
                        <div>Gesamt km</div>
                        <div class="cost-amount" id="totalTripKm">0</div>
                    </div>
                    <div class="cost-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                        <div>Gesch√§ftlich</div>
                        <div class="cost-amount" id="businessKm">0</div>
                    </div>
                    <div class="cost-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <div>Privat</div>
                        <div class="cost-amount" id="privateKm">0</div>
                    </div>
                </div>

                <div class="trip-list" id="tripList"></div>
            </div>
        </section>

        <!-- Community Section -->
        <section id="community" class="section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Community & Tipps</h2>
                    <button class="btn btn-primary">+ Beitrag erstellen</button>
                </div>
                
                <div class="search-box">
                    <input type="text" placeholder="Suche nach Modell, Problem oder Tipp...">
                </div>
                
                <div class="filter-tags">
                    <span class="tag active">Alle</span>
                    <span class="tag">Technik</span>
                    <span class="tag">Kaufberatung</span>
                    <span class="tag">DIY</span>
                    <span class="tag">Probleme</span>
                </div>

                <div id="communityPosts">
                    <div class="community-post">
                        <div class="post-header">
                            <div class="avatar">LS</div>
                            <div>
                                <div style="font-weight: bold;">Lisa S.</div>
                                <div style="font-size: 12px; color: #666;">VW Golf 7 ‚Ä¢ Vor 3 Stunden</div>
                            </div>
                        </div>
                        <h4>Wasser im Fu√üraum - was tun?</h4>
                        <p>Habe seit gestern Wasser im Beifahrerfu√üraum. Kann das von der Klimaanlage kommen?</p>
                        <div style="margin-top: 10px; color: #666; font-size: 14px;">
                            üí¨ 12 Antworten ‚Ä¢ üëç 5 Hilfreich
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Add Car Modal -->
    <div id="addCarModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 25px;">Neues Fahrzeug hinzuf√ºgen</h2>
            <form id="addCarForm" onsubmit="saveCar(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Marke *</label>
                        <select id="carBrand" required onchange="updateModels()">
                            <option value="">Marke w√§hlen...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Modell *</label>
                        <select id="carModel" required onchange="updateYears()" disabled>
                            <option value="">Zuerst Marke w√§hlen...</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Baujahr *</label>
                        <select id="carYear" required onchange="updateEngines()" disabled>
                            <option value="">Zuerst Modell w√§hlen...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Motorisierung</label>
                        <select id="carEngine" disabled>
                            <option value="">Zuerst Baujahr w√§hlen...</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Kennzeichen *</label>
                        <input type="text" id="carPlate" placeholder="M-XX 1234" required>
                    </div>
                    <div class="form-group">
                        <label>Aktueller Kilometerstand *</label>
                        <input type="number" id="carMileage" placeholder="50000" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Erstzulassung</label>
                        <input type="date" id="carFirstReg">
                    </div>
                    <div class="form-group">
                        <label>N√§chste T√úV/HU</label>
                        <input type="date" id="carTuv">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Fahrzeug-Identifikationsnummer (VIN)</label>
                        <input type="text" id="carVin" placeholder="WVWZZZ1JZ3W386752" maxlength="17">
                    </div>
                    <div class="form-group">
                        <label>Schl√ºsselnummer (HSN/TSN)</label>
                        <input type="text" id="carKeyNum" placeholder="1234/567">
                    </div>
                </div>

                <div class="form-group">
                    <label>Finanzierung/Leasing</label>
                    <select id="carFinance">
                        <option value="cash">Barkauf</option>
                        <option value="credit">Kredit</option>
                        <option value="leasing">Leasing</option>
                    </select>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="button" class="btn" onclick="closeModal('addCarModal')" style="flex: 1; background: #e5e7eb;">
                        Abbrechen
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        Speichern
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Service Entry Modal -->
    <div id="addServiceModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 25px;">Service-Eintrag hinzuf√ºgen</h2>
            <form id="addServiceForm" onsubmit="saveServiceEntry(event)">
                <input type="hidden" id="serviceCarId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Datum *</label>
                        <input type="date" id="serviceDate" required>
                    </div>
                    <div class="form-group">
                        <label>Kilometerstand *</label>
                        <input type="number" id="serviceMileage" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Service-Art *</label>
                    <select id="serviceType" required>
                        <option value="inspektion">üîß Inspektion</option>
                        <option value="oelwechsel">üõ¢Ô∏è √ñlwechsel</option>
                        <option value="reifen">üöó Reifenwechsel</option>
                        <option value="bremsen">üõë Bremsenservice</option>
                        <option value="tuev">‚úì T√úV/HU</option>
                        <option value="klima">‚ùÑÔ∏è Klimaservice</option>
                        <option value="achsvermessung">üìê Achsvermessung</option>
                        <option value="getriebe">‚öôÔ∏è Getriebe</option>
                        <option value="unfall">üí• Unfallreparatur</option>
                        <option value="reparatur">üî© Reparatur</option>
                        <option value=" tuning">üèéÔ∏è Tuning</option>
                        <option value="sonstiges">üìã Sonstiges</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Beschreibung</label>
                    <textarea id="serviceDesc" rows="3" placeholder="Was wurde gemacht? Welche Teile wurden getauscht?"></textarea>
                </div>

                <div class="form-row-3">
                    <div class="form-group">
                        <label>Teilekosten (‚Ç¨)</label>
                        <input type="number" id="servicePartsCost" step="0.01" placeholder="0.00" onchange="calcTotal()">
                    </div>
                    <div class="form-group">
                        <label>Arbeitskosten (‚Ç¨)</label>
                        <input type="number" id="serviceLaborCost" step="0.01" placeholder="0.00" onchange="calcTotal()">
                    </div>
                    <div class="form-group">
                        <label>Gesamtkosten (‚Ç¨)</label>
                        <input type="number" id="serviceCost" step="0.01" placeholder="0.00" readonly style="background: #f3f4f6;">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Werkstatt</label>
                        <select id="serviceWorkshop">
                            <option value="">Selbst gemacht</option>
                            <option value="atu">ATU</option>
                            <option value="pitstop">PIT STOP</option>
                            <option value="vertrag">Vertragswerkstatt</option>
                            <option value="frei">Freie Werkstatt</option>
                            <option value="sonstige">Sonstige</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Rechnungsnummer</label>
                        <input type="text" id="serviceInvoice" placeholder="RE-2024-001">
                    </div>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="button" class="btn" onclick="closeModal('addServiceModal')" style="flex: 1; background: #e5e7eb;">
                        Abbrechen
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        Speichern
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Fuel Entry Modal -->
    <div id="addFuelModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 25px;">Tankf√ºllung eintragen</h2>
            <form id="addFuelForm" onsubmit="saveFuelEntry(event)">
                <div class="form-group">
                    <label>Fahrzeug</label>
                    <select id="fuelCarId" required></select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Datum</label>
                        <input type="date" id="fuelDate" required>
                    </div>
                    <div class="form-group">
                        <label>Kilometerstand</label>
                        <input type="number" id="fuelMileage" required>
                    </div>
                </div>

                <div class="form-row-3">
                    <div class="form-group">
                        <label>Getankte Liter *</label>
                        <input type="number" id="fuelLiters" step="0.01" required onchange="calcConsumption()">
                    </div>
                    <div class="form-group">
                        <label>Preis pro Liter (‚Ç¨)</label>
                        <input type="number" id="fuelPrice" step="0.001" onchange="calcConsumption()">
                    </div>
                    <div class="form-group">
                        <label>Gesamtkosten (‚Ç¨)</label>
                        <input type="number" id="fuelTotalCost" step="0.01" onchange="reverseCalc()">
                    </div>
                </div>

                <div class="form-group">
                    <label>Tankstelle</label>
                    <input type="text" id="fuelStation" placeholder="z.B. Shell, Aral...">
                </div>

                <div class="form-group">
                    <label>Spritart</label>
                    <select id="fuelType">
                        <option value="e5">Super E5</option>
                        <option value="e10">Super E10</option>
                        <option value="diesel">Diesel</option>
                        <option value="premium">Super Plus</option>
                        <option value="adblue">AdBlue</option>
                    </select>
                </div>

                <div style="background: #f0f7ff; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <strong>Berechneter Verbrauch:</strong>
                    <div id="calcConsumption" style="font-size: 24px; color: var(--primary); font-weight: bold;">-- l/100km</div>
                </div>

                <div style="display: flex; gap: 15px;">
                    <button type="button" class="btn" onclick="closeModal('addFuelModal')" style="flex: 1; background: #e5e7eb;">
                        Abbrechen
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        Speichern
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Trip Entry Modal -->
    <div id="addTripModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 25px;">Fahrt eintragen</h2>
            <form id="addTripForm" onsubmit="saveTrip(event)">
                <div class="form-group">
                    <label>Fahrzeug</label>
                    <select id="tripCarId" required></select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Datum</label>
                        <input type="date" id="tripDate" required>
                    </div>
                    <div class="form-group">
                        <label>Fahrtart</label>
                        <select id="tripType">
                            <option value="business">Gesch√§ftlich</option>
                            <option value="private">Privat</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Startort</label>
                        <input type="text" id="tripStart" placeholder="M√ºnchen" required>
                    </div>
                    <div class="form-group">
                        <label>Zielort</label>
                        <input type="text" id="tripEnd" placeholder="Stuttgart" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Kilometer (Start)</label>
                        <input type="number" id="tripKmStart" required>
                    </div>
                    <div class="form-group">
                        <label>Kilometer (Ende)</label>
                        <input type="number" id="tripKmEnd" required onchange="calcTripKm()">
                    </div>
                </div>

                <div class="form-group">
                    <label>Gefahrene Strecke: <span id="tripDistance" style="color: var(--primary); font-weight: bold;">0</span> km</label>
                    <div class="progress-bar">
                        <div class="progress-fill" id="tripProgress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Zweck der Fahrt</label>
                    <input type="text" id="tripPurpose" placeholder="Kundenbesuch, Baustelle, etc.">
                </div>

                <div style="display: flex; gap: 15px;">
                    <button type="button" class="btn" onclick="closeModal('addTripModal')" style="flex: 1; background: #e5e7eb;">
                        Abbrechen
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        Speichern
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Upload Document Modal -->
    <div id="uploadDocModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 25px;">Dokument hochladen</h2>
            <form id="uploadDocForm" onsubmit="saveDocument(event)">
                <div class="form-group">
                    <label>Dokumenttyp</label>
                    <select id="docType" required>
                        <option value="zulassung">Fahrzeugschein (Zulassungsbescheinigung)</option>
                        <option value="brief">Fahrzeugbrief</option>
                        <option value="versicherung">Versicherungsnachweis</option>
                        <option value="tuev">T√úV-Bericht</option>
                        <option value="rechnung">Rechnung</option>
                        <option value="vertrag">Kauf-/Leasingvertrag</option>
                        <option value="service">Serviceheft (digital)</option>
                        <option value="sonstiges">Sonstiges</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Betreffendes Fahrzeug</label>
                    <select id="docCarId" required></select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Ablaufdatum (falls zutreffend)</label>
                        <input type="date" id="docExpiry">
                    </div>
                    <div class="form-group">
                        <label>Erinnerung (Tage vorher)</label>
                        <select id="docReminder">
                            <option value="0">Keine</option>
                            <option value="7">1 Woche</option>
                            <option value="14">2 Wochen</option>
                            <option value="30">1 Monat</option>
                            <option value="90">3 Monate</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Datei ausw√§hlen</label>
                    <input type="file" id="docFile" accept=".pdf,.jpg,.jpeg,.png" required>
                </div>

                <div class="form-group">
                    <label>Notizen</label>
                    <textarea id="docNotes" rows="2"></textarea>
                </div>

                <div style="display: flex; gap: 15px;">
                    <button type="button" class="btn" onclick="closeModal('uploadDocModal')" style="flex: 1; background: #e5e7eb;">
                        Abbrechen
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        Hochladen
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Panel -->
    <div id="notificationPanel" class="notification-panel">
        <h3 style="margin-bottom: 15px;">üîî Erinnerungen</h3>
        <div id="notificationList"></div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Comprehensive Vehicle Database
        const vehicleDatabase = {
            "Audi": {
                "A1": { years: [2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], 
                    engines: ["1.0 TFSI 95 PS", "1.4 TFSI 125 PS", "1.6 TDI 116 PS", "2.0 TDI 143 PS", "S1 2.0 TFSI 231 PS"] },
                "A3": { years: [1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.2 TFSI 105 PS", "1.4 TFSI 125 PS", "1.4 TFSI 150 PS", "1.6 TDI 110 PS", "2.0 TDI 150 PS", "2.0 TFSI 190 PS", "S3 2.0 TFSI 310 PS", "RS3 2.5 TFSI 400 PS", "e-tron 204 PS"] },
                "A4": { years: [1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.4 TFSI 150 PS", "2.0 TFSI 190 PS", "2.0 TFSI 252 PS", "2.0 TDI 136 PS", "2.0 TDI 163 PS", "2.0 TDI 190 PS", "3.0 TDI 218 PS", "S4 3.0 TFSI 354 PS", "RS4 2.9 TFSI 450 PS"] },
                "A5": { years: [2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["2.0 TFSI 190 PS", "2.0 TFSI 252 PS", "2.0 TDI 190 PS", "3.0 TDI 218 PS", "S5 3.0 TFSI 354 PS", "RS5 2.9 TFSI 450 PS"] },
                "A6": { years: [1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["2.0 TFSI 245 PS", "2.0 TDI 204 PS", "3.0 TDI 231 PS", "3.0 TDI 286 PS", "S6 2.9 TFSI 450 PS", "RS6 4.0 TFSI 600 PS", "e-tron 367 PS"] },
                "Q3": { years: [2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.4 TFSI 150 PS", "2.0 TFSI 180 PS", "2.0 TFSI 220 PS", "2.0 TDI 150 PS", "2.0 TDI 184 PS", "RS Q3 2.5 TFSI 400 PS"] },
                "Q5": { years: [2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["2.0 TFSI 245 PS", "2.0 TDI 190 PS", "3.0 TDI 286 PS", "SQ5 3.0 TDI 347 PS", "SQ5 3.0 TFSI 354 PS"] },
                "TT": { years: [1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023],
                    engines: ["1.8 TFSI 180 PS", "2.0 TFSI 230 PS", "2.0 TFSI 310 PS", "TTS 2.0 TFSI 320 PS", "TT RS 2.5 TFSI 400 PS"] }
            },
            "BMW": {
                "1er": { years: [2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["116i 1.5 109 PS", "118i 1.5 136 PS", "120i 2.0 184 PS", "M135i 2.0 306 PS", "116d 1.5 116 PS", "118d 2.0 150 PS", "120d 2.0 190 PS"] },
                "3er": { years: [1975, 1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["318i 2.0 156 PS", "320i 2.0 184 PS", "330i 2.0 258 PS", "M340i 3.0 374 PS", "316d 2.0 116 PS", "320d 2.0 190 PS", "330d 3.0 265 PS", "M3 3.0 510 PS", "330e Plug-in 292 PS"] },
                "5er": { years: [1972, 1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["520i 2.0 184 PS", "530i 2.0 252 PS", "540i 3.0 333 PS", "M550i 4.4 530 PS", "520d 2.0 190 PS", "530d 3.0 286 PS", "M5 4.4 600 PS", "530e Plug-in 292 PS"] },
                "X1": { years: [2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["sDrive18i 1.5 140 PS", "sDrive20i 2.0 192 PS", "xDrive25i 2.0 231 PS", "sDrive18d 2.0 150 PS", "xDrive20d 2.0 190 PS"] },
                "X3": { years: [2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["xDrive20i 2.0 184 PS", "xDrive30i 2.0 252 PS", "xDrive20d 2.0 190 PS", "xDrive30d 3.0 265 PS", "M40i 3.0 360 PS", "xDrive30e Plug-in 292 PS"] },
                "X5": { years: [1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["xDrive40i 3.0 333 PS", "xDrive45e Plug-in 394 PS", "xDrive30d 3.0 265 PS", "xDrive40d 3.0 352 PS", "M50i 4.4 530 PS", "M Competition 4.4 625 PS"] }
            },
            "Mercedes": {
                "A-Klasse": { years: [1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["A 160 1.3 109 PS", "A 180 1.3 136 PS", "A 200 1.3 163 PS", "A 220 2.0 190 PS", "A 250 2.0 224 PS", "A 35 AMG 2.0 306 PS", "A 45 AMG 2.0 421 PS", "A 180 d 1.5 116 PS", "A 200 d 2.0 150 PS", "A 220 d 2.0 190 PS"] },
                "C-Klasse": { years: [1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["C 180 1.5 170 PS", "C 200 1.5 204 PS", "C 300 2.0 258 PS", "C 43 AMG 2.0 408 PS", "C 63 AMG 2.0 476 PS", "C 200 d 2.0 163 PS", "C 220 d 2.0 200 PS", "C 300 d 2.0 265 PS", "C 300 e Plug-in 313 PS"] },
                "E-Klasse": { years: [1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["E 200 2.0 197 PS", "E 300 2.0 258 PS", "E 450 3.0 367 PS", "E 53 AMG 3.0 435 PS", "E 63 AMG 4.0 571 PS", "E 200 d 2.0 160 PS", "E 220 d 2.0 194 PS", "E 300 d 2.0 265 PS", "E 300 e Plug-in 313 PS"] },
                "GLA": { years: [2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["GLA 180 1.3 136 PS", "GLA 200 1.3 163 PS", "GLA 250 2.0 224 PS", "GLA 35 AMG 2.0 306 PS", "GLA 45 AMG 2.0 421 PS", "GLA 180 d 1.5 116 PS", "GLA 200 d 2.0 150 PS", "GLA 220 d 2.0 190 PS"] },
                "GLC": { years: [2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["GLC 200 2.0 204 PS", "GLC 300 2.0 258 PS", "GLC 43 AMG 2.0 421 PS", "GLC 63 AMG 4.0 476 PS", "GLC 200 d 2.0 163 PS", "GLC 220 d 2.0 194 PS", "GLC 300 d 2.0 265 PS", "GLC 300 e Plug-in 313 PS"] },
                "GLE": { years: [2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["GLE 350 2.0 258 PS", "GLE 450 3.0 367 PS", "GLE 53 AMG 3.0 435 PS", "GLE 63 AMG 4.0 571 PS", "GLE 300 d 2.0 245 PS", "GLE 350 d 3.0 272 PS", "GLE 400 d 3.0 330 PS", "GLE 350 e Plug-in 333 PS"] }
            },
            "VW": {
                "Polo": { years: [1975, 1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.0 MPI 65 PS", "1.0 TSI 95 PS", "1.0 TSI 110 PS", "1.5 TSI 150 PS", "2.0 GTI 207 PS", "1.6 TDI 95 PS", "1.6 TDI 115 PS", "2.0 GTI 320 PS"] },
                "Golf": { years: [1974, 1975, 1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.0 TSI 90 PS", "1.0 TSI 110 PS", "1.5 TSI 130 PS", "1.5 TSI 150 PS", "2.0 GTI 245 PS", "2.0 GTI 300 PS", "2.0 R 320 PS", "1.6 TDI 115 PS", "2.0 TDI 150 PS", "2.0 TDI 200 PS", "1.5 TGI 130 PS", "GTE Plug-in 204 PS", "GTE Plug-in 245 PS"] },
                "Passat": { years: [1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.5 TSI 150 PS", "2.0 TSI 190 PS", "2.0 TSI 280 PS", "1.6 TDI 120 PS", "2.0 TDI 150 PS", "2.0 TDI 200 PS", "2.0 TDI 240 PS", "GTE Plug-in 218 PS"] },
                "Tiguan": { years: [2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.4 TSI 125 PS", "1.5 TSI 150 PS", "2.0 TSI 190 PS", "2.0 TSI 245 PS", "2.0 TDI 150 PS", "2.0 TDI 200 PS", "2.0 TDI 240 PS", "eHybrid Plug-in 245 PS"] },
                "T-Roc": { years: [2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.0 TSI 110 PS", "1.5 TSI 150 PS", "2.0 TSI 190 PS", "2.0 TSI 300 PS R", "1.6 TDI 115 PS", "2.0 TDI 150 PS"] },
                "Arteon": { years: [2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.5 TSI 150 PS", "2.0 TSI 190 PS", "2.0 TSI 280 PS", "2.0 TDI 150 PS", "2.0 TDI 200 PS", "eHybrid Plug-in 218 PS"] },
                "ID.3": { years: [2020, 2021, 2022, 2023, 2024],
                    engines: ["Pro 150 kW (204 PS)", "Pro S 150 kW (204 PS)", "GTX 220 kW (299 PS)"] },
                "ID.4": { years: [2020, 2021, 2022, 2023, 2024],
                    engines: ["Pure 109 kW (148 PS)", "Pro 150 kW (204 PS)", "GTX 220 kW (299 PS)"] }
            },
            "Opel": {
                "Corsa": { years: [1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.2 75 PS", "1.2 Turbo 100 PS", "1.2 Turbo 130 PS", "1.5 Diesel 102 PS", "e-Corsa Elektro 136 PS"] },
                "Astra": { years: [1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.2 Turbo 110 PS", "1.2 Turbo 130 PS", "1.2 Turbo 145 PS", "1.5 Diesel 122 PS", "1.6 Turbo 200 PS GSe", "1.6 Plug-in 225 PS"] },
                "Insignia": { years: [2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022],
                    engines: ["1.5 Turbo 140 PS", "1.5 Turbo 165 PS", "2.0 Turbo 200 PS", "2.0 Turbo 230 PS", "2.0 Diesel 174 PS", "2.0 Diesel 210 PS"] },
                "Mokka": { years: [2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.2 Turbo 100 PS", "1.2 Turbo 130 PS", "1.5 Diesel 110 PS", "e-Mokka Elektro 136 PS"] },
                "Grandland": { years: [2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.2 Turbo 130 PS", "1.6 Turbo 180 PS", "1.5 Diesel 130 PS", "Hybrid 225 PS", "Hybrid4 300 PS"] }
            },
            "Ford": {
                "Fiesta": { years: [1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023],
                    engines: ["1.0 EcoBoost 95 PS", "1.0 EcoBoost 125 PS", "1.0 EcoBoost 155 PS", "1.5 TDCi 85 PS", "1.5 TDCi 120 PS", "1.5 EcoBoost 200 PS ST"] },
                "Focus": { years: [1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.0 EcoBoost 100 PS", "1.0 EcoBoost 125 PS", "1.0 EcoBoost 155 PS", "1.5 EcoBoost 150 PS", "2.3 EcoBoost 280 PS ST", "1.5 EcoBlue 95 PS", "1.5 EcoBlue 120 PS", "2.0 EcoBlue 150 PS"] },
                "Kuga": { years: [2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.5 EcoBoost 150 PS", "2.0 EcoBoost 190 PS", "2.5 Plug-in 225 PS", "1.5 EcoBlue 120 PS", "2.0 EcoBlue 150 PS", "2.0 EcoBlue 190 PS", "2.5 Hybrid 190 PS"] },
                "Puma": { years: [2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.0 EcoBoost 125 PS", "1.0 EcoBoost 155 PS", "1.0 EcoBoost 170 PS ST-Line", "1.5 EcoBoost 200 PS ST"] },
                "Mustang": { years: [1964, 1965, 1966, 1967, 1968, 1969, 1970, 1971, 1972, 1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["2.3 EcoBoost 290 PS", "5.0 V8 450 PS GT", "5.0 V8 460 PS Mach 1", "5.2 V8 760 PS Shelby GT500", "Mach-E Elektro 269-487 PS"] }
            },
            "Toyota": {
                "Yaris": { years: [1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.0 VVT-i 72 PS", "1.5 Hybrid 116 PS", "1.6 GR 261 PS", "1.5 VVT-i 125 PS"] },
                "Corolla": { years: [1966, 1967, 1968, 1969, 1970, 1971, 1972, 1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["1.2 Turbo 116 PS", "1.8 Hybrid 122 PS", "2.0 Hybrid 180 PS", "2.0 GR 300 PS"] },
                "RAV4": { years: [1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["2.0 175 PS", "2.5 Hybrid 222 PS", "2.5 Plug-in 306 PS", "2.5 Hybrid 218 PS AWD"] },
                "Camry": { years: [1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["2.5 Hybrid 218 PS", "3.5 V6 301 PS"] },
                "GR Supra": { years: [2019, 2020, 2021, 2022, 2023, 2024],
                    engines: ["2.0 Turbo 258 PS", "3.0 Turbo 340 PS", "3.0 Turbo 387 PS"] }
            },
            "Andere": {
                "Manuell eingeben": { years: [], engines: [] }
            }
        };

        // Data Storage
        let cars = JSON.parse(localStorage.getItem('cars')) || [];
        let serviceEntries = JSON.parse(localStorage.getItem('serviceEntries')) || [];
        let fuelEntries = JSON.parse(localStorage.getItem('fuelEntries')) || [];
        let trips = JSON.parse(localStorage.getItem('trips')) || [];
        let documents = JSON.parse(localStorage.getItem('documents')) || [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initBrandSelect();
            renderGarage();
            updateCarSelects();
            loadDocuments();
            loadTrips();
            checkReminders();
            
            // Set today's date as default
            document.getElementById('serviceDate').valueAsDate = new Date();
            document.getElementById('fuelDate').valueAsDate = new Date();
            document.getElementById('tripDate').valueAsDate = new Date();
        });

        // Initialize Brand Select
        function initBrandSelect() {
            const select = document.getElementById('carBrand');
            Object.keys(vehicleDatabase).forEach(brand => {
                const option = document.createElement('option');
                option.value = brand;
                option.textContent = brand;
                select.appendChild(option);
            });
        }

        // Update Models based on Brand
        function updateModels() {
            const brand = document.getElementById('carBrand').value;
            const modelSelect = document.getElementById('carModel');
            const yearSelect = document.getElementById('carYear');
            const engineSelect = document.getElementById('carEngine');
            
            modelSelect.innerHTML = '<option value="">Modell w√§hlen...</option>';
            yearSelect.innerHTML = '<option value="">Zuerst Modell w√§hlen...</option>';
            engineSelect.innerHTML = '<option value="">Zuerst Baujahr w√§hlen...</option>';
            
            yearSelect.disabled = true;
            engineSelect.disabled = true;
            
            if (brand && vehicleDatabase[brand]) {
                Object.keys(vehicleDatabase[brand]).forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelSelect.appendChild(option);
                });
                modelSelect.disabled = false;
            } else {
                modelSelect.disabled = true;
            }
        }

        // Update Years based on Model
        function updateYears() {
            const brand = document.getElementById('carBrand').value;
            const model = document.getElementById('carModel').value;
            const yearSelect = document.getElementById('carYear');
            const engineSelect = document.getElementById('carEngine');
            
            yearSelect.innerHTML = '<option value="">Baujahr w√§hlen...</option>';
            engineSelect.innerHTML = '<option value="">Zuerst Baujahr w√§hlen...</option>';
            engineSelect.disabled = true;
            
            if (brand && model && vehicleDatabase[brand][model]) {
                const years = vehicleDatabase[brand][model].years;
                years.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearSelect.appendChild(option);
                });
                yearSelect.disabled = false;
            } else {
                yearSelect.disabled = true;
            }
        }

        // Update Engines based on Year
        function updateEngines() {
            const brand = document.getElementById('carBrand').value;
            const model = document.getElementById('carModel').value;
            const engineSelect = document.getElementById('carEngine');
            
            engineSelect.innerHTML = '<option value="">Motor w√§hlen...</option>';
            
            if (brand === 'Andere') {
                engineSelect.innerHTML += '<option value="custom">Manuell eingeben</option>';
                engineSelect.disabled = false;
                return;
            }
            
            if (brand && model && vehicleDatabase[brand][model]) {
                const engines = vehicleDatabase[brand][model].engines;
                engines.forEach(engine => {
                    const option = document.createElement('option');
                    option.value = engine;
                    option.textContent = engine;
                    engineSelect.appendChild(option);
                });
                engineSelect.disabled = false;
            }
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.closest('.nav-btn').classList.add('active');
            
            // Hide quick actions for some sections
            const quickActions = document.getElementById('quickActions');
            if (sectionId === 'documents' || sectionId === 'community') {
                quickActions.style.display = 'none';
            } else {
                quickActions.style.display = 'grid';
            }
            
            if (sectionId === 'checkbook') loadCheckbook();
            if (sectionId === 'costs') loadCosts();
            if (sectionId === 'trips') loadTrips();
            if (sectionId === 'documents') loadDocuments();
        }

        function switchTab(tab, contentId) {
            tab.parentElement.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(contentId).classList.add('active');
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Car Management
        function saveCar(event) {
            event.preventDefault();
            
            const brand = document.getElementById('carBrand').value;
            const model = document.getElementById('carModel').value;
            
            const car = {
                id: Date.now(),
                brand: brand,
                model: model === 'Manuell eingeben' ? document.getElementById('carModel').value : model,
                year: parseInt(document.getElementById('carYear').value) || new Date().getFullYear(),
                plate: document.getElementById('carPlate').value,
                engine: document.getElementById('carEngine').value,
                mileage: parseInt(document.getElementById('carMileage').value),
                firstReg: document.getElementById('carFirstReg').value,
                tuv: document.getElementById('carTuv').value,
                vin: document.getElementById('carVin').value,
                keyNum: document.getElementById('carKeyNum').value,
                finance: document.getElementById('carFinance').value,
                added: new Date().toISOString()
            };
            
            cars.push(car);
            localStorage.setItem('cars', JSON.stringify(cars));
            
            // Create initial T√úV entry if provided
            if (car.tuv) {
                serviceEntries.push({
                    id: Date.now() + 1,
                    carId: car.id,
                    date: car.tuv,
                    mileage: car.mileage,
                    type: 'tuev',
                    desc: 'T√úV/Hauptuntersuchung',
                    partsCost: 0,
                    laborCost: 0,
                    cost: 0,
                    workshop: ''
                });
                localStorage.setItem('serviceEntries', JSON.stringify(serviceEntries));
            }
            
            renderGarage();
            updateCarSelects();
            closeModal('addCarModal');
            document.getElementById('addCarForm').reset();
            
            // Reset dependent selects
            document.getElementById('carModel').disabled = true;
            document.getElementById('carYear').disabled = true;
            document.getElementById('carEngine').disabled = true;
            
            showToast('Fahrzeug erfolgreich hinzugef√ºgt!');
            checkReminders();
        }

        function deleteCar(id) {
            if (confirm('M√∂chtest du dieses Fahrzeug wirklich l√∂schen? Alle dazugeh√∂rigen Daten werden entfernt.')) {
                cars = cars.filter(c => c.id !== id);
                serviceEntries = serviceEntries.filter(e => e.carId !== id);
                fuelEntries = fuelEntries.filter(f => f.carId !== id);
                trips = trips.filter(t => t.carId !== id);
                documents = documents.filter(d => d.carId !== id);
                
                localStorage.setItem('cars', JSON.stringify(cars));
                localStorage.setItem('serviceEntries', JSON.stringify(serviceEntries));
                localStorage.setItem('fuelEntries', JSON.stringify(fuelEntries));
                localStorage.setItem('trips', JSON.stringify(trips));
                localStorage.setItem('documents', JSON.stringify(documents));
                
                renderGarage();
                updateCarSelects();
                showToast('Fahrzeug gel√∂scht');
            }
        }

        function renderGarage() {
            const grid = document.getElementById('garageGrid');
            
            if (cars.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">üèéÔ∏è</div>
                        <h3>Deine Garage ist leer</h3>
                        <p>F√ºge dein erstes Fahrzeug hinzu, um loszulegen.</p>
                        <button class="btn btn-primary" onclick="openModal('addCarModal')" style="margin-top: 20px;">
                            Auto hinzuf√ºgen
                        </button>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = cars.map(car => {
                const entries = serviceEntries.filter(e => e.carId === car.id);
                const totalCosts = entries.reduce((sum, e) => sum + (parseFloat(e.cost) || 0), 0);
                const nextTuv = car.tuv ? new Date(car.tuv) : null;
                const today = new Date();
                const daysUntilTuv = nextTuv ? Math.ceil((nextTuv - today) / (1000 * 60 * 60 * 24)) : null;
                const tuvWarning = daysUntilTuv !== null && daysUntilTuv < 30;
                const tuvExpired = daysUntilTuv !== null && daysUntilTuv < 0;
                
                return `
                    <div class="car-card">
                        <button class="delete-btn" onclick="deleteCar(${car.id})">√ó</button>
                        ${tuvWarning ? `<div class="reminder-badge" style="${tuvExpired ? 'background: #000;' : ''}">${tuvExpired ? '‚Äº' : '!'}</div>` : ''}
                        <div class="car-image">
                            <div class="car-badge">${car.year}</div>
                            üöó
                        </div>
                        <div class="car-name">${car.brand} ${car.model}</div>
                        <div class="car-details">
                            ${car.engine || 'k.A.'}<br>
                            ${car.plate || 'Kein Kennzeichen'}
                        </div>
                        <div class="car-stats">
                            <div class="stat">
                                <div class="stat-value">${car.mileage.toLocaleString()}</div>
                                <div class="stat-label">km</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${entries.length}</div>
                                <div class="stat-label">Services</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${totalCosts.toFixed(0)}‚Ç¨</div>
                                <div class="stat-label">Kosten</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" style="${tuvExpired ? 'color: var(--danger);' : tuvWarning ? 'color: var(--secondary);' : ''}">
                                    ${car.tuv ? daysUntilTuv + ' Tg' : '--'}
                                </div>
                                <div class="stat-label">T√úV</div>
                            </div>
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" 
                                onclick="openServiceModal(${car.id})">
                            + Service eintragen
                        </button>
                    </div>
                `;
            }).join('');
        }

        function updateCarSelects() {
            const options = cars.map(c => `<option value="${c.id}">${c.brand} ${c.model}</option>`).join('');
            
            document.getElementById('carSelectCheckbook').innerHTML = '<option value="">Fahrzeug w√§hlen...</option>' + options;
            document.getElementById('carSelectCosts').innerHTML = '<option value="">Alle Fahrzeuge</option>' + options;
            document.getElementById('tripCarSelect').innerHTML = '<option value="">Alle Fahrzeuge</option>' + options;
            
            // Update modal selects
            document.getElementById('fuelCarId').innerHTML = options;
            document.getElementById('tripCarId').innerHTML = options;
            document.getElementById('docCarId').innerHTML = options;
        }

        // Service/Checkbook Management
        function openServiceModal(carId) {
            document.getElementById('serviceCarId').value = carId;
            const car = cars.find(c => c.id === carId);
            document.getElementById('serviceMileage').value = car ? car.mileage : '';
            document.getElementById('serviceDate').valueAsDate = new Date();
            openModal('addServiceModal');
        }

        function calcTotal() {
            const parts = parseFloat(document.getElementById('servicePartsCost').value) || 0;
            const labor = parseFloat(document.getElementById('serviceLaborCost').value) || 0;
            document.getElementById('serviceCost').value = (parts + labor).toFixed(2);
        }

        function saveServiceEntry(event) {
            event.preventDefault();
            
            const entry = {
                id: Date.now(),
                carId: parseInt(document.getElementById('serviceCarId').value),
                date: document.getElementById('serviceDate').value,
                mileage: parseInt(document.getElementById('serviceMileage').value),
                type: document.getElementById('serviceType').value,
                desc: document.getElementById('serviceDesc').value,
                partsCost: parseFloat(document.getElementById('servicePartsCost').value) || 0,
                laborCost: parseFloat(document.getElementById('serviceLaborCost').value) || 0,
                cost: parseFloat(document.getElementById('serviceCost').value) || 0,
                workshop: document.getElementById('serviceWorkshop').value,
                invoice: document.getElementById('serviceInvoice').value
            };
            
            serviceEntries.push(entry);
            
            // Update car mileage if higher
            const car = cars.find(c => c.id === entry.carId);
            if (car && entry.mileage > car.mileage) {
                car.mileage = entry.mileage;
                localStorage.setItem('cars', JSON.stringify(cars));
                renderGarage();
            }
            
            localStorage.setItem('serviceEntries', JSON.stringify(serviceEntries));
            closeModal('addServiceModal');
            document.getElementById('addServiceForm').reset();
            
            if (document.getElementById('checkbook').classList.contains('active')) {
                loadCheckbook();
            }
            showToast('Service-Eintrag gespeichert!');
        }

        function loadCheckbook() {
            const
